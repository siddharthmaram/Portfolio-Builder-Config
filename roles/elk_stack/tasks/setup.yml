---

- name: Install kubectl if not present
  snap:
    name: kubectl
    state: present
    classic: yes

- name: Check if Minikube is installed
  stat:
    path: /usr/local/bin/minikube
  register: minikube_stat


- name: Install Minikube if not present
  command: |
    curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    chmod +x minikube
    sudo mv minikube /usr/local/bin/
  when: not minikube_stat.stat.exists

- name: Check Minikube status
  ansible.builtin.command: minikube status
  register: minikube_status
  failed_when: minikube_status.rc not in [0, 7, 85]
  changed_when: false 

- name: Start Minikube if it is not running or does not exist
  ansible.builtin.command: minikube start
  when: >
    minikube_status.rc != 0 or
    "Profile \"minikube\" not found" in minikube_status.stdout or
    "Stopped" in minikube_status.stdout
